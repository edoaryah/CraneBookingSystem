@model AspnetCoreMvcFull.ViewModels.UsageManagement.UsageSubcategoryListViewModel
@{
  ViewData["Title"] = "Usage Management";
  Layout = "_ContentNavbarLayout";
}

@section PageScripts {
  <script>
    // Script untuk menghilangkan alert secara otomatis setelah 5 detik
    $(document).ready(function () {
      setTimeout(function () {
        $('.auto-close-alert').fadeOut('slow', function () {
          $(this).remove();
        });
      }, 5000); // 5000 milliseconds = 5 detik
    });
  </script>
}

<div class="card">
  <div class="card-header d-flex justify-content-between align-items-center">
    <h5 class="mb-0">Usage Subcategory Management</h5>
    <a href="@Url.Action("Create", "UsageManagement")" class="btn btn-primary">
      <i class="bx bx-plus me-1"></i> Add New Subcategory
    </a>
  </div>

  @if (ViewBag.SuccessMessage != null)
  {
    <div class="alert alert-success alert-dismissible fade show auto-close-alert m-3" role="alert">
      @ViewBag.SuccessMessage
      <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
  }

  @if (ViewBag.ErrorMessage != null)
  {
    <div class="alert alert-danger alert-dismissible fade show auto-close-alert m-3" role="alert">
      @ViewBag.ErrorMessage
      <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
  }

  <div class="table-responsive text-nowrap">
    <table class="table table-hover">
      <thead>
        <tr>
          <th>#</th>
          <th>Category</th>
          <th>Name</th>
          <th>Description</th>
          <th>Status</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody class="table-border-bottom-0">
        @{
          int rowNumber = 1;
        }
        @foreach (var subcategory in Model.Subcategories)
        {
          <tr style="cursor: pointer;"
            onclick="window.location='@Url.Action("Details", "UsageManagement", new { id = subcategory.Id })'">
            <td><strong>@(rowNumber++)</strong></td>
            <td>
              <span class="badge" style="background-color: @GetCategoryColor(subcategory.Category)">
                @subcategory.CategoryName
              </span>
            </td>
            <td>@subcategory.Name</td>
            <td>@(string.IsNullOrEmpty(subcategory.Description) ? "-" : TruncateText(subcategory.Description, 27))</td>
            <td>
              @if (subcategory.IsActive)
              {
                <span class="badge bg-success">Active</span>
              }
              else
              {
                <span class="badge bg-secondary">Inactive</span>
              }
            </td>
            <td onclick="event.stopPropagation();">
              <div class="action-buttons">
                <button type="button" class="btn btn-sm btn-outline-primary edit-btn"
                  onclick="window.location='@Url.Action("Edit", "UsageManagement", new { id = subcategory.Id })'"
                  data-id="@subcategory.Id" title="Edit">
                  <i class="bx bx-edit-alt"></i>
                </button>
                <button type="button" class="btn btn-sm btn-outline-danger delete-btn"
                  onclick="window.location='@Url.Action("Delete", "UsageManagement", new { id = subcategory.Id })'"
                  data-id="@subcategory.Id" data-name="@System.Web.HttpUtility.HtmlAttributeEncode(subcategory.Name)"
                  title="Delete">
                  <i class="bx bx-trash"></i>
                </button>
              </div>
            </td>
          </tr>
        }
      </tbody>
    </table>
  </div>
</div>

@functions {
  public string GetCategoryColor(UsageCategory category)
  {
    return category switch
    {
      UsageCategory.Operating => "#28a745", // Green
      UsageCategory.Delay => "#ffc107", // Yellow
      UsageCategory.Standby => "#6c757d", // Gray
      UsageCategory.Service => "#17a2b8", // Cyan
      UsageCategory.Breakdown => "#dc3545", // Red
      _ => "#6c757d" // Default Gray
    };
  }

  public string TruncateText(string text, int maxLength)
  {
    if (string.IsNullOrEmpty(text) || text.Length <= maxLength)
      return text;

    return text.Substring(0, maxLength) + "...";
  }
}
